<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:vm="clr-namespace:EurabankMobileClient.ViewModels"
             xmlns:models="clr-namespace:EurabankMobileClient.Models"
             x:Class="EurabankMobileClient.Views.MovimientosPage"
             x:DataType="vm:MovimientosViewModel"
             Title="{Binding Title}">

    <Grid RowDefinitions="Auto,*,Auto">
        
        <!-- Información del Cliente -->
        <Frame Grid.Row="0" Padding="15" BackgroundColor="White" 
               CornerRadius="0" HasShadow="True" Margin="0">
            <VerticalStackLayout Spacing="5">
                <Label Text="{Binding NombreCliente}" 
                       FontSize="18" FontAttributes="Bold" TextColor="#333"/>
                <Label Text="{Binding CodigoCuenta, StringFormat='Cuenta: {0}'}" 
                       FontSize="14" TextColor="#666"/>
                <Label Text="{Binding SaldoActual, StringFormat='Saldo: {0:C}'}" 
                       FontSize="16" FontAttributes="Bold" TextColor="#4CAF50"/>
            </VerticalStackLayout>
        </Frame>

        <!-- Lista de Movimientos -->
        <RefreshView Grid.Row="1" 
                     Command="{Binding ActualizarCommand}"
                     IsRefreshing="{Binding IsBusy}">
            <CollectionView ItemsSource="{Binding Movimientos}"
                           SelectionMode="None"
                           Margin="10">
                <CollectionView.ItemTemplate>
                    <DataTemplate x:DataType="models:MovimientoDto">
                        <Frame Padding="15" Margin="0,5" 
                               BackgroundColor="White" 
                               CornerRadius="10" HasShadow="True">
                            <Grid RowDefinitions="Auto,Auto,Auto" 
                                  ColumnDefinitions="*,Auto">
                                
                                <!-- Tipo de Movimiento -->
                                <Label Grid.Row="0" Grid.Column="0"
                                       Text="{Binding NombreTipo}" 
                                       FontSize="16" FontAttributes="Bold" 
                                       TextColor="#333"/>
                                
                                <!-- Monto -->
                                <Label Grid.Row="0" Grid.Column="1"
                                       Text="{Binding Importe, StringFormat='{0:C}'}" 
                                       FontSize="18" FontAttributes="Bold" 
                                       TextColor="#2196F3"
                                       HorizontalTextAlignment="End"/>
                                
                                <!-- Fecha -->
                                <Label Grid.Row="1" Grid.Column="0"
                                       Text="{Binding Fecha, StringFormat='{0:dd/MM/yyyy HH:mm}'}" 
                                       FontSize="12" TextColor="#999"/>
                                
                                <!-- Número -->
                                <Label Grid.Row="1" Grid.Column="1"
                                       Text="{Binding Numero, StringFormat='#{0}'}" 
                                       FontSize="12" TextColor="#999"
                                       HorizontalTextAlignment="End"/>
                                
                                <!-- Referencia (si existe) -->
                                <Label Grid.Row="2" Grid.Column="0" Grid.ColumnSpan="2"
                                       Text="{Binding CuentaReferencia, StringFormat='Ref: {0}'}" 
                                       FontSize="11" TextColor="#666"
                                       IsVisible="{Binding CuentaReferencia, Converter={StaticResource StringNotEmptyConverter}}"
                                       Margin="0,5,0,0"/>
                            </Grid>
                        </Frame>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
                
                <CollectionView.EmptyView>
                    <VerticalStackLayout VerticalOptions="Center" Padding="20">
                        <Label Text="No hay movimientos" 
                               FontSize="18" TextColor="#999" 
                               HorizontalOptions="Center"/>
                    </VerticalStackLayout>
                </CollectionView.EmptyView>
            </CollectionView>
        </RefreshView>

        <!-- Botones -->
        <Grid Grid.Row="2" ColumnDefinitions="*,*" ColumnSpacing="10" 
              Padding="10" BackgroundColor="#F5F5F5">
            <Button Grid.Column="0" 
                    Text="Actualizar" 
                    Command="{Binding ActualizarCommand}"
                    BackgroundColor="#2196F3" TextColor="White"
                    FontAttributes="Bold" CornerRadius="8" HeightRequest="50"/>
            
            <Button Grid.Column="1" 
                    Text="Volver" 
                    Command="{Binding VolverCommand}"
                    BackgroundColor="#9E9E9E" TextColor="White"
                    FontAttributes="Bold" CornerRadius="8" HeightRequest="50"/>
        </Grid>

    </Grid>

</ContentPage>
